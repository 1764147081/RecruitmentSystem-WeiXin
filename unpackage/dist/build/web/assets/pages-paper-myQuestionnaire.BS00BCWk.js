import{_ as e,D as t,r as a,N as n,O as s,a as o,c as l,e as i,w as u,p as r,H as c,i as d,d as f,f as p,k as y,t as _,g as m,B as w,F as h,m as q,C as v}from"./index-BIrkV5je.js";const k=e({__name:"myQuestionnaire",setup(e){const k=t("QuestionnaireInfo"),I=t("authToken"),x=a(null),C=n({title:"",description:""}),b=a([]),g=a([]);a([]);const $=a([]),B=a([]);async function z(){try{const e=await r({url:`/answer/view/user_questionnaire?questionnaireId=${k.questionnaireId}`,header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${I}`}});x.value=e.data.id,await async function(){try{const e=await r({url:`/answer/view/answers?finishId=${x.value}`,header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${I}`}});if(200===e.code)return b.value=e.data,await async function(){try{const e=await r({url:`/department/view/questions?departmentId=${k.departmentId}`,header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${I}`}});console.log("Question data:",e.data.questions),g.value=e.data.questions,$.value=g.value.map((e=>{const t=b.value.filter((t=>t.questionId===e.id));if(t.length>0){if(3===t[0].type&&(e.answerContent=t[0].answerContent),2===t[0].type||1===t[0].type){const a=t.map((e=>e.optionId));e.option=e.option.filter((e=>a.includes(e.optionId)))}}else 3===e.type&&(e.answerContent="");return e}))}catch(e){console.error("获取问卷信息失败:",e)}}(),!0}catch(e){b.value=[]}return!1}()}catch(e){console.error("获取问卷完成ID失败:",e)}}return s((async()=>{await z(),await async function(){const e=await r({url:`/comment/view/finish?finishId=${x.value}`,header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${I}`}});B.value=e.data.filter((e=>1===e.viewable))}(),console.log(B.value)})),(e,t)=>{const a=o(l("u-navbar"),c),n=v,s=d;return f(),i(s,{class:"user-questionnaires-container"},{default:u((()=>[p(a,{title:"我的问卷","left-icon":"arrow-left","auto-back":"","bg-color":"#F8F8F8","title-color":"#000000",border:!1}),C?(f(),i(s,{key:0,class:"questionnaire-list"},{default:u((()=>[p(s,{class:"questionnaire-item"},{default:u((()=>[p(s,{class:"questionnaire-header"},{default:u((()=>[p(n,{class:"questionnaire-title"},{default:u((()=>[y(_(C.title),1)])),_:1})])),_:1}),p(s,{class:"questionnaire-content"},{default:u((()=>[p(n,{class:"questionnaire-description"},{default:u((()=>[y(_(C.description),1)])),_:1}),p(s,{class:"questions-list"},{default:u((()=>[(f(!0),m(h,null,w($.value,((e,t)=>(f(),i(s,{key:t,class:"question-item"},{default:u((()=>[p(s,{class:"question-header"},{default:u((()=>[p(n,{class:"question-number"},{default:u((()=>[y(_(t+1)+".",1)])),_:2},1024),p(n,{class:"question-text"},{default:u((()=>[y(_(e.content),1)])),_:2},1024),1===e.type?(f(),i(n,{key:0,class:"question-type"},{default:u((()=>[y("[单选题]")])),_:1})):2===e.type?(f(),i(n,{key:1,class:"question-type"},{default:u((()=>[y("[多选题]")])),_:1})):3===e.type?(f(),i(n,{key:2,class:"question-type"},{default:u((()=>[y("[填空题]")])),_:1})):q("",!0)])),_:2},1024),1===e.type?(f(),i(s,{key:0,class:"options"},{default:u((()=>[(f(!0),m(h,null,w(e.option,((e,t)=>(f(),i(s,{key:t,class:"option-item"},{default:u((()=>[p(s,{class:"option-label"},{default:u((()=>[y(_(String.fromCharCode(65+t)),1)])),_:2},1024),p(s,{class:"option-text"},{default:u((()=>[y(_(e.optionContent),1)])),_:2},1024),p(s,{class:"checkmark"},{default:u((()=>[y("✓")])),_:1})])),_:2},1024)))),128))])),_:2},1024)):2===e.type?(f(),i(s,{key:1,class:"options"},{default:u((()=>[(f(!0),m(h,null,w(e.option,((e,t)=>(f(),i(s,{key:t,class:"option-item"},{default:u((()=>[p(s,{class:"option-label"},{default:u((()=>[y(_(String.fromCharCode(65+t)),1)])),_:2},1024),p(s,{class:"option-text"},{default:u((()=>[y(_(e.optionContent),1)])),_:2},1024),p(s,{class:"checkmark"},{default:u((()=>[y("✓")])),_:1})])),_:2},1024)))),128))])),_:2},1024)):3===e.type?(f(),i(s,{key:2,class:"textarea-container"},{default:u((()=>[p(s,{class:"user-answer"},{default:u((()=>[p(n,null,{default:u((()=>[y(_(e.answerContent),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)):q("",!0)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1})):(f(),i(s,{key:1,class:"empty-state"},{default:u((()=>[p(n,{class:"empty-text"},{default:u((()=>[y("暂无问卷数据")])),_:1})])),_:1})),B.value&&B.value.length>0?(f(),i(s,{key:2,class:"comment-list"},{default:u((()=>[p(s,{class:"comment-list-header"},{default:u((()=>[p(n,{class:"comment-list-title"},{default:u((()=>[y("评论")])),_:1})])),_:1}),(f(!0),m(h,null,w(B.value,((e,t)=>(f(),i(s,{class:"comment-item",key:t},{default:u((()=>[p(n,{class:"comment-content"},{default:u((()=>[y(_(e.content),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):q("",!0)])),_:1})}}},[["__scopeId","data-v-45f2d9e8"]]);export{k as default};
