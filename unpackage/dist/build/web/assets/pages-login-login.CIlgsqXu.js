import{_ as e,r as a,o as l,a as s,b as o,c as t,d as u,e as n,w as c,f as r,i as d,u as i,s as p,g as f,F as m,h as v,j as g,n as h,k as _,l as b,m as w,t as k,p as y,q as x,v as V,x as U,y as I,z as T,A as L}from"./index-BIrkV5je.js";const S=e({__name:"Toast",setup(e){a(!1);const i=a({type:"success",message:"如未设置密码请先通过统一认证登录",iconUrl:"https://uview-plus.jiangruyi.com/resources/toast/success.png",position:"top"}),p=a(null);return l((()=>{var e;e=i.value,p.value.show({...e})})),(e,a)=>{const l=s(t("up-toast"),o),i=d;return u(),n(i,{class:"toast"},{default:c((()=>[r(l,{ref_key:"uToastRef",ref:p},null,512)])),_:1})}}},[["__scopeId","data-v-8b9bdfff"]]),C=""+new URL("SDU-ByNr2Fhw.png",import.meta.url).href,j=""+new URL("logo-7Pcf2oog.png",import.meta.url).href,D=e({__name:"login",setup(e){const o=i(),D=a(""),F=a(""),N=a(!1),P=a("password"),R=a(""),A=a(!1);function B(e){P.value=e,R.value=""}function O(){B("unified")}async function q(){let e;if(console.log("stuID:",D.value),console.log("password:",F.value),"unified"===P.value&&(A.value=!1),"unified"===P.value){console.log("现在使用统一认证登录");const a={studentNumber:D.value,password:F.value,fingerprint:D.value};R.value&&(a.captcha=R.value),e=await y({url:"/user/login/cas",method:"POST",data:a,header:{"content-type":"application/x-www-form-urlencoded"}})}else console.log("现在使用账号密码登录"),e=await y({url:"/user/login",method:"POST",data:{studentNumber:D.value,password:F.value},header:{"content-type":"application/x-www-form-urlencoded"}});if(200===e.code){const a=e.data;console.log("Login successful, token:",a),N.value,x("authToken",a),o.setLoginData({token:a,userInfo:e.data.userInfo}),V({url:"/pages/department/department"})}else 400===e.code&&"需要验证码"===e.msg?(A.value=!0,U({title:"请输入验证码",icon:"none",position:"top"})):U({title:e.msg||"登录失败",icon:"none",position:"top"})}return l((()=>{o.isLoggedIn.value&&(console.log("用户已登录，跳转到首页"),p({url:"/pages/department/department"}))})),(e,a)=>{const l=s(t("Toast"),S),o=I,i=d,p=s(t("up-input"),v),y=s(t("up-checkbox"),g),x=T,V=L;return u(),f(m,null,[r(l,{position:"top",class:"top-toast"}),r(i,{class:"background"},{default:c((()=>[r(o,{src:C,alt:""})])),_:1}),r(i,{class:"logo"},{default:c((()=>[r(o,{src:j,alt:"",mode:"widthFix"})])),_:1}),r(i,{class:"container"},{default:c((()=>[r(i,{class:"login-tabs"},{default:c((()=>[r(i,{class:h(["tab-btn",{active:"password"===P.value}]),onClick:a[0]||(a[0]=e=>B("password"))},{default:c((()=>[_(" 账号密码登录")])),_:1},8,["class"]),r(i,{class:h(["tab-btn",{active:"unified"===P.value}]),onClick:a[1]||(a[1]=e=>B("unified"))},{default:c((()=>[_("统一认证登录 ")])),_:1},8,["class"])])),_:1}),r(i,null,{default:c((()=>[r(i,{class:"form-login"},{default:c((()=>[r(V,{onSubmit:b(q,["prevent"])},{default:c((()=>[r(p,{class:"input",placeholder:"请输入学号",border:"surround",modelValue:D.value,"onUpdate:modelValue":a[2]||(a[2]=e=>D.value=e),clearable:""},null,8,["modelValue"]),r(p,{class:"input",placeholder:"请输入密码",border:"surround",modelValue:F.value,"onUpdate:modelValue":a[3]||(a[3]=e=>F.value=e),clearable:"",password:""},null,8,["modelValue"]),A.value?(u(),n(i,{key:0,class:"captcha-container"},{default:c((()=>[r(p,{class:"input captcha-input",placeholder:"请输入验证码",border:"surround",modelValue:R.value,"onUpdate:modelValue":a[4]||(a[4]=e=>R.value=e),clearable:"",type:"number",maxlength:"6"},null,8,["modelValue"])])),_:1})):w("",!0),r(i,{class:"checkbox-and-register"},{default:c((()=>[r(y,{customStyle:{marginBottom:"5px"},label:"自动登录",name:"agree",usedAlone:"",checked:N.value,"onUpdate:checked":a[5]||(a[5]=e=>N.value=e)},null,8,["checked"]),r(i,{class:"register-link",onClick:O},{default:c((()=>[_("注册")])),_:1})])),_:1}),r(x,{class:"button-form",onClick:a[6]||(a[6]=e=>q())},{default:c((()=>[_(k("password"===P.value?"账号密码登录":"统一认证登录"),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})],64)}}},[["__scopeId","data-v-f19d2889"]]);export{D as default};
