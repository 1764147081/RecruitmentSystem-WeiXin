import{_ as a,G as e,D as t,p as s,x as n,I as l,a as i,c as o,e as r,w as c,H as u,i as d,d as f,f as m,k as h,t as g,y as _,C as p,z as w}from"./index-C2_1g6db.js";import{u as v}from"./department.Bfsr-auH.js";const b=a({data:()=>({username:"",college:"",name:"",email:"",qq:"",major:"",avatar:"",profile:"",questionnaires:[],questionnaireId:"",departmentDetail:{},tag:"",tagId:null}),methods:{viewQuestionnaire(a,t){e({url:`/pages/department/user-questionnaires?username=${a}&questionnaireId=${t}`})},async getTag(){const a=t("authToken");try{const e=await s({url:`/tag/view?username=${this.username}&departId=${this.departmentDetail.id}`,header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${a}`}});null!==e.data&&(this.tag=e.data.value||"",this.tagId=e.data.id),e.data=null}catch(e){console.error("获取标签信息失败:",e),this.tag=""}},async deleteTag(){const a=t("authToken");try{200===(await s({url:`/tag/delete?tagId=${this.tagId}`,header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${a}`},method:"DELETE"})).code?(this.tag="",n({title:"删除成功",icon:"success"})):""===this.tag&&n({title:"没有发现tag呢~",icon:"none"})}catch(e){console.error("删除标签失败:",e),n({title:"删除失败",icon:"none"})}},async editTag(){if(""!==this.tag)n({title:"请先清空tag",icon:"none"});else{const e=prompt("请输入新的标签:",this.tag);if(null===e)return;const l=t("authToken");try{200===(await s({url:`/tag/create?username=${this.username}&departId=${this.departmentDetail.id}&value=${e}`,header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${l}`},method:"POST"})).code?(this.tag=e,n({title:"修改成功",icon:"success"})):n({title:"修改失败",icon:"none"})}catch(a){console.error("修改标签失败:",a),n({title:"修改失败",icon:"none"})}}},async getUserInfoByUsername(a){const e=t("authToken");let l;try{l=await s({url:`/user/info?username=${a}`,method:"GET",header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${e}`}}),l&&l.data&&(this.username=l.data.username||"",this.college=l.data.college||"",this.name=l.data.name||"",this.email=l.data.email||"",this.qq=l.data.qq||"",this.avatar=l.data.avatar||"/static/assets/nav_icon_avatar_nor.png",this.profile=l.data.profile||"这个人很懒，什么都没有写",this.major=l.data.major,await this.getTag())}catch(i){console.error("获取用户信息失败:",i),n({title:"获取用户信息失败",icon:"none"})}}},onLoad(a){const e=a.username,t=l();this.questionnaireId=t.query.questionnaireId,e&&this.getUserInfoByUsername(e);const s=v();this.departmentDetail=s.getDepartmentDetail()}},[["render",function(a,e,t,s,n,l){const v=i(o("u-navbar"),u),b=_,q=d,y=p,T=w;return f(),r(q,{class:"user-info-container"},{default:c((()=>[m(v,{title:"用户信息","left-icon":"arrow-left","auto-back":"","bg-color":"#F8F8F8","title-color":"#000000",border:!1}),m(q,{class:"user-header"},{default:c((()=>[m(q,{class:"avatar-container"},{default:c((()=>[m(b,{class:"avatar",src:n.avatar,mode:"aspectFill"},null,8,["src"])])),_:1}),m(q,{class:"user-info"},{default:c((()=>[m(y,{class:"user-name"},{default:c((()=>[h(g(n.name||n.username),1)])),_:1}),m(y,{class:"user-desc"},{default:c((()=>[h(g(n.profile||"这个人很懒，什么都没有写"),1)])),_:1})])),_:1})])),_:1}),m(q,{class:"info-list"},{default:c((()=>[m(q,{class:"info-item"},{default:c((()=>[m(y,{class:"info-label"},{default:c((()=>[h("学院")])),_:1}),m(y,{class:"info-value"},{default:c((()=>[h(g(n.college),1)])),_:1})])),_:1}),m(q,{class:"info-item"},{default:c((()=>[m(y,{class:"info-label"},{default:c((()=>[h("专业")])),_:1}),m(y,{class:"info-value"},{default:c((()=>[h(g(n.major),1)])),_:1})])),_:1}),m(q,{class:"info-item"},{default:c((()=>[m(y,{class:"info-label"},{default:c((()=>[h("邮箱")])),_:1}),m(y,{class:"info-value"},{default:c((()=>[h(g(n.email),1)])),_:1})])),_:1}),m(q,{class:"info-item"},{default:c((()=>[m(y,{class:"info-label"},{default:c((()=>[h("学号")])),_:1}),m(y,{class:"info-value"},{default:c((()=>[h(g(n.username),1)])),_:1})])),_:1}),m(q,{class:"info-item"},{default:c((()=>[m(y,{class:"info-label"},{default:c((()=>[h("QQ")])),_:1}),m(y,{class:"info-value"},{default:c((()=>[h(g(n.qq),1)])),_:1})])),_:1}),m(q,{class:"info-item"},{default:c((()=>[m(y,{class:"info-label"},{default:c((()=>[h("Tag")])),_:1}),m(y,{class:"info-value"},{default:c((()=>[h(g(n.tag),1)])),_:1})])),_:1}),m(q,{class:"tag-buttons"},{default:c((()=>[m(T,{class:"tag-button delete-button",onClick:l.deleteTag},{default:c((()=>[h("清空Tag")])),_:1},8,["onClick"]),m(T,{class:"tag-button edit-button",onClick:l.editTag},{default:c((()=>[h("修改Tag")])),_:1},8,["onClick"])])),_:1})])),_:1}),m(q,{class:"view-questionnaire-btn",onClick:e[0]||(e[0]=a=>l.viewQuestionnaire(n.username,n.questionnaireId))},{default:c((()=>[m(y,{class:"btn-text"},{default:c((()=>[h("查看所填问卷内容")])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-e3ed566a"]]);export{b as default};
