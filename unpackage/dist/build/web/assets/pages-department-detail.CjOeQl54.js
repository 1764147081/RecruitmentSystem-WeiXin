import{_ as a,D as e,u as t,r as n,o as i,a as o,c as s,e as r,w as c,p as l,x as d,G as u,H as f,i as p,d as m,f as v,k as w,t as g,m as _,y as k,z as b}from"./index-C2_1g6db.js";import{u as h}from"./department.Bfsr-auH.js";const y=a({setup(){const a=e("authToken"),o=h();t();const s=n(!1);n("");const r=n({});let c=n({id:"",stationId:"",name:"",image:"",description:""}),f=n(""),p=n(!1);i((async()=>{await async function(){const e=await l({url:"/user/info",method:"GET",header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${a}`}});f.value=e.data.username}();const e=o.getDepartmentDetail();e&&Object.keys(e).length>0?(r.value=e,c.value=e,console.log("从store获取部门详情数据成功:",r.value)):console.error("从store获取部门详情数据失败"),await async function(){(await l({url:`/permission/show/user?username=${f.value}`,header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${a}`}})).data.forEach((a=>{a.stationId===c.value.stationId&&(p.value=!0)}))}()}));return{departmentInfo:r,navigateToQuestionnaire:async()=>{let e=await async function(){return await l({url:`/department/view/questionnaire?departmentId=${c.value.id}`,header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${a}`}})}(),t=await async function(e){return await l({url:`/answer/view/user_questionnaire?questionnaireId=${e}`,header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${a}`}})}(e.data.id);200===e.code&&404===t.code&&(0===e.data.status&&d({title:"该部门未发布问卷",icon:"none"}),200===e.code&&1===e.data.status?(c.value.questionnaireId=e.data.id,u({url:`/pages/department/questionnaire?id=${c.value.questionnaireId}&departmentId=${c.value.id}`})):d({title:"该部门暂无问卷",icon:"none"})),200===t.code&&d({title:"您已填写该问卷",icon:"none"}),404===e.code&&d({title:"该部门未发布问卷",icon:"none"})},loading:s,navigateToDepartment:()=>{u({url:"/pages/department/department"})},navigateToPaper:()=>{u({url:"/pages/paper/paper"})},navigateToInfo:()=>{u({url:"/pages/info/info"})},navigateToAdmin:()=>{u({url:`/pages/department/admin?departmentId=${r.value.id}`})},info:c,ifAdmin:p}}},[["render",function(a,e,t,n,i,l){const d=o(s("u-navbar"),f),u=k,h=p,y=b;return m(),r(h,{class:"detail-container"},{default:c((()=>[v(d,{title:"部门详情","left-icon":"arrow-left","auto-back":"","bg-color":"#F8F8F8","title-color":"#000000",border:!1}),v(h,{class:"poster-container"},{default:c((()=>[v(u,{src:n.info&&n.info.image,mode:"widthFix"},null,8,["src"])])),_:1}),v(h,{class:"intro-container"},{default:c((()=>[v(h,{class:"section-title"},{default:c((()=>[w("部门名称")])),_:1}),v(h,{class:"section-content"},{default:c((()=>[w(g(n.info&&n.info.name?n.info.name:"奇妙的无名氏"),1)])),_:1})])),_:1}),v(h,{class:"intro-container"},{default:c((()=>[v(h,{class:"section-title"},{default:c((()=>[w("部门介绍")])),_:1}),v(h,{class:"section-content"},{default:c((()=>[w(g(n.info&&n.info.description?n.info.description:"暂无部门介绍"),1)])),_:1})])),_:1}),v(h,{class:"btn-container"},{default:c((()=>[v(y,{class:"submit-btn",onClick:n.navigateToQuestionnaire},{default:c((()=>[w("点击报名")])),_:1},8,["onClick"]),n.ifAdmin?(m(),r(y,{key:0,class:"admin-btn",onClick:n.navigateToAdmin},{default:c((()=>[w("我的管理")])),_:1},8,["onClick"])):_("",!0)])),_:1}),v(h,{class:"tab-bar"},{default:c((()=>[v(h,{class:"tab-item active",onClick:n.navigateToDepartment},{default:c((()=>[w("部门展览")])),_:1},8,["onClick"]),v(h,{class:"tab-item",onClick:n.navigateToPaper},{default:c((()=>[w("已填报")])),_:1},8,["onClick"]),v(h,{class:"tab-item",onClick:n.navigateToInfo},{default:c((()=>[w("个人中心")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-fd09cac9"]]);export{y as default};
