import{_ as e,u as t,r as n,I as a,o,J as l,a as s,c as i,e as u,w as r,p as c,D as d,x as p,v,G as f,H as y,i as g,d as h,f as m,k as I,t as _,K as k,m as q,g as C,B as O,F as b,C as w,L as x,z as Q,n as T}from"./index-C2_1g6db.js";let V=null;const A=e({onLoad(e){e&&e.id&&(V=e.id,console.log("Questionnaire ID from onLoad:",V))},setup(){const e=t(),s=n(e.user.username),i=a(),u=n(null),r=i.query.departmentId,y=n([]),g=n(null),h=n(0),m=n(null),I=n([]),_=n(""),k=n({}),q=n({}),C=async()=>{if(u.value)try{const e=await c({url:`/department/view/questions?departmentId=${r}`,method:"GET",header:{"content-type":"application/json",Authorization:`Bearer ${d("authToken")}`}});200===e.code&&(y.value=(e.data.questions||[]).map((e=>({...e,question:e.content,options:(e.option||[]).map(((e,t)=>({...e,optionContent:e.optionContent||e,id:void 0!==e.id?e.id:t})))}))),h.value=0,k.value=y.value[h.value],console.log("获取题目数据成功:",e.data)),e.data.question&&0!==e.data.question.length||p({title:"管理员并未上传题目",icon:"none"}),404===e.code?p({title:e.msg||"该部门无问题",icon:"none"}):(console.error("获取题目数据失败:",e.message),p({title:e.msg||"获取题目数据失败",icon:"none"}))}catch(e){console.error("获取题目数据异常:",e),p({title:"网络错误",icon:"none"})}else console.error("问卷ID未设置")};o((async()=>{if(V)u.value=V,console.log("Questionnaire ID from onLoad:",u.value);else{const e=l(),t=e[e.length-1].options;t&&t.id&&(u.value=t.id,console.log("Questionnaire ID from options:",u.value))}C()}));const O=()=>{const e=h.value,t=y.value[e];1===t.type?q.value[e]={type:1,selectedOption:m.value}:2===t.type?q.value[e]={type:2,selectedOptions:[...I.value]}:3===t.type&&(q.value[e]={type:3,fillValue:_.value})},b=()=>{const e=h.value,t=q.value[e];m.value=null,I.value=[],_.value="",t&&(1===t.type&&void 0!==t.selectedOption?m.value=t.selectedOption:2===t.type&&Array.isArray(t.selectedOptions)?I.value=[...t.selectedOptions]:3===t.type&&void 0!==t.fillValue&&(_.value=t.fillValue))},w=async()=>{const e=await async function(){return await c({url:"/answer/create/finish",header:{"content-type":"application/json",Authorization:`Bearer ${d("authToken")}`},method:"POST",data:{questionnaireId:u.value}})}();if(g.value=await async function(){try{const e=await c({url:"/answer/view/user_questionnaire",header:{"content-type":"application/json",Authorization:`Bearer ${d("authToken")}`},data:{questionnaireId:parseInt(u.value),username:s.value}});return 200===e.code&&e.data?e.data.id:(console.error("获取finishId失败:",e.message),null)}catch(e){return console.error("获取finishId异常:",e),null}}(),4090===e.code&&p({title:"您已填写该问卷",icon:"success"}),200===e.code){const e=[];for(let n=0;n<y.value.length;n++){const t=y.value[n],a=q.value[n];if(1===t.type){const n={questionId:t.id,questionnaireId:u.value,finishId:g.value,type:t.type};a&&void 0!==a.selectedOption&&t.options[a.selectedOption]&&(n.optionId=t.options[a.selectedOption].optionId,e.push(n))}else if(2===t.type){if(a&&Array.isArray(a.selectedOptions))for(const n of a.selectedOptions)if(t.options[n]){const a={questionId:t.id,questionnaireId:u.value,finishId:g.value,type:t.type,optionId:t.options[n].optionId};e.push(a)}}else if(3===t.type){const n={questionId:t.id,questionnaireId:u.value,finishId:g.value,type:t.type};a&&void 0!==a.fillValue&&(n.answerContent=a.fillValue,e.push(n))}}const t=await async function(e){return console.log(e),await c({url:`/answer/save?finishId=${g.value}`,header:{"content-type":"application/json",Authorization:`Bearer ${d("authToken")}`},method:"POST",data:{questionnaireId:u.value,answerList:e}})}(e);if(200!==t.code)return console.error("上传答案失败:",t.message),void p({title:"答案上传失败",icon:"none"});p({title:"问卷提交成功",icon:"success"})}setTimeout((()=>{v({url:"/pages/paper/paper"})}),1500)};return h.value=0,y.value.length>0&&(k.value=y.value[h.value]),{questions:y,currentIndex:h,selectedOption:m,selectedOptions:I,fillValue:_,currentQuestion:k,questionnaireId:u,username:s,answers:q,getQuestions:C,selectOption:e=>{m.value=e,q.value[h.value]={type:1,selectedOption:e}},toggleOption:e=>{const t=I.value.indexOf(e);-1===t?I.value.push(e):I.value.splice(t,1),q.value[h.value]={type:2,selectedOptions:[...I.value]}},saveCurrentAnswer:O,restoreCurrentAnswer:b,prevQuestion:()=>{h.value>0&&(O(),h.value--,k.value=y.value[h.value],b())},nextQuestion:()=>{1!==k.value.type||null!==m.value?2!==k.value.type||0!==I.value.length?3!==k.value.type||_.value&&_.value.trim()?(O(),h.value<y.value.length-1?(h.value++,k.value=y.value[h.value],b()):w()):p({title:"请输入答案",icon:"none"}):p({title:"请至少选择一个选项",icon:"none"}):p({title:"请选择一个选项",icon:"none"})},navigateToDepartment:()=>{f({url:"/pages/department/department"})},navigateToPaper:()=>{f({url:"/pages/paper/paper"})},navigateToInfo:()=>{f({url:"/pages/info/info"})}}}},[["render",function(e,t,n,a,o,l){const c=s(i("u-navbar"),y),d=w,p=g,v=x,f=Q;return h(),u(p,{class:"questionnaire-container"},{default:r((()=>[m(c,{title:"部门报名问卷","left-icon":"arrow-left","auto-back":"","bg-color":"#F8F8F8","title-color":"#000000",border:!1}),m(p,{class:"header"},{default:r((()=>[m(d,{class:"title"},{default:r((()=>[I(_(a.currentQuestion.title),1)])),_:1}),m(p,{class:"progress-container"},{default:r((()=>[m(p,{class:"progress-bar"},{default:r((()=>[m(p,{class:"progress-fill",style:k({width:(a.currentIndex+1)/a.questions.length*100+"%"})},null,8,["style"])])),_:1}),m(d,{class:"progress-text"},{default:r((()=>[I(_(a.currentIndex+1)+"/"+_(a.questions.length),1)])),_:1})])),_:1})])),_:1}),m(p,{class:"question-content"},{default:r((()=>[m(d,{class:"question-text"},{default:r((()=>[I(_(a.currentQuestion.question),1)])),_:1}),1===a.currentQuestion.type?(h(),u(d,{key:0,class:"question-type"},{default:r((()=>[I("[单选题]")])),_:1})):2===a.currentQuestion.type?(h(),u(d,{key:1,class:"question-type"},{default:r((()=>[I("[多选题]")])),_:1})):q("",!0),1===a.currentQuestion.type?(h(),u(p,{key:2,class:"options"},{default:r((()=>[(h(!0),C(b,null,O(a.currentQuestion.options,((e,t)=>(h(),u(p,{key:t,class:T(["option-item",{selected:a.selectedOption===t}]),onClick:e=>a.selectOption(t)},{default:r((()=>[m(p,{class:"option-label"},{default:r((()=>[I(_(String.fromCharCode(65+t)),1)])),_:2},1024),m(p,{class:"option-text"},{default:r((()=>[I(_(e.optionContent),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})):2===a.currentQuestion.type?(h(),u(p,{key:3,class:"options"},{default:r((()=>[(h(!0),C(b,null,O(a.currentQuestion.options,((e,t)=>(h(),u(p,{key:t,class:T(["option-item",{selected:a.selectedOptions.includes(t)}]),onClick:e=>a.toggleOption(t)},{default:r((()=>[m(p,{class:"option-label"},{default:r((()=>[I(_(String.fromCharCode(65+t)),1)])),_:2},1024),m(p,{class:"option-text"},{default:r((()=>[I(_(e.optionContent),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})):3===a.currentQuestion.type?(h(),u(p,{key:4,class:"textarea-container"},{default:r((()=>[m(v,{modelValue:a.fillValue,"onUpdate:modelValue":t[0]||(t[0]=e=>a.fillValue=e),class:"textarea",placeholder:"请输入您的答案"},null,8,["modelValue"])])),_:1})):q("",!0)])),_:1}),m(p,{class:"button-group"},{default:r((()=>[m(f,{class:"btn prev-btn",disabled:0===a.currentIndex,onClick:a.prevQuestion},{default:r((()=>[I("上一题")])),_:1},8,["disabled","onClick"]),m(f,{class:"btn next-btn",onClick:a.nextQuestion},{default:r((()=>[I(_(a.currentIndex===a.questions.length-1?"提交":"下一题"),1)])),_:1},8,["onClick"])])),_:1}),m(p,{class:"tab-bar"},{default:r((()=>[m(p,{class:"tab-item active",onClick:a.navigateToDepartment},{default:r((()=>[I("部门展览")])),_:1},8,["onClick"]),m(p,{class:"tab-item",onClick:a.navigateToPaper},{default:r((()=>[I("已填报")])),_:1},8,["onClick"]),m(p,{class:"tab-item",onClick:a.navigateToInfo},{default:r((()=>[I("个人中心")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-764b6c48"]]);export{A as default};
