import{_ as e,o as a,a as t,c as l,d as s,g as n,B as d,e as o,w as r,f as i,k as u,t as m,m as c,F as p,n as f,C as D,i as y,D as v,r as _,E as h,p as w,h as b,x as k,G as x,z as g}from"./index-BIrkV5je.js";import{u as C}from"./department.DSvR3flN.js";const A=e({__name:"RecursiveModule",props:{modules:{type:Array,required:!0},level:{type:Number,required:!0},unfoldStation:{type:Function,required:!0},viewDepartmentDetail:{type:Function,required:!0}},setup(e){a((()=>{console.log("渲染组件加载")}));const v=e;return(a,_)=>{const h=D,w=y,b=t(l("RecursiveModule"),A);return s(!0),n(p,null,d(e.modules,(a=>(s(),o(w,{key:a.id,class:f("module-item level-"+e.level)},{default:r((()=>[1===a.isDepartment?(s(),o(w,{key:0,class:"module-header leaf-node",onClick:t=>e.viewDepartmentDetail(a.id)},{default:r((()=>[i(h,{class:"module-name"},{default:r((()=>[u(m(a.name),1)])),_:2},1024)])),_:2},1032,["onClick"])):(s(),o(w,{key:1},{default:r((()=>[i(w,{class:"module-header",onClick:e=>(e=>{e.expanded=!e.expanded,e.expanded&&e.submodules&&0===e.submodules.length&&v.unfoldStation(e.id,e)})(a)},{default:r((()=>[i(h,{class:"module-name"},{default:r((()=>[u(m(a.name),1)])),_:2},1024),i(h,{class:"arrow-icon"},{default:r((()=>[u(m(a.expanded?"▼":"►"),1)])),_:2},1024)])),_:2},1032,["onClick"]),a.expanded?(s(),o(w,{key:0,class:"submodule-list"},{default:r((()=>[a.submodules&&a.submodules.length>0&&e.level<10?(s(),o(b,{key:0,modules:a.submodules,level:e.level+1,unfoldStation:e.unfoldStation,viewDepartmentDetail:e.viewDepartmentDetail},null,8,["modules","level","unfoldStation","viewDepartmentDetail"])):c("",!0),a.departments&&a.departments.length>0?(s(),o(w,{key:1,class:"department-list"},{default:r((()=>[(s(!0),n(p,null,d(a.departments,(a=>(s(),o(w,{key:a.id,class:"department-item",onClick:t=>e.viewDepartmentDetail(a.id)},{default:r((()=>[i(h,null,{default:r((()=>[u(m(a.name),1)])),_:2},1024),i(h,{class:"arrow-right"},{default:r((()=>[u("→")])),_:1})])),_:2},1032,["onClick"])))),128))])),_:2},1024)):c("",!0)])),_:2},1024)):c("",!0)])),_:2},1024))])),_:2},1032,["class"])))),128)}}},[["__scopeId","data-v-9592d133"]]),I=e({__name:"department",setup(e){const n=v("authToken"),d=C(),m=_([]),c=_(""),p=async()=>{if(c.value)try{const e=await w({url:"/station/search",method:"GET",data:{name:c.value},header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${n}`}});if(200===e.code){let a=[];if(Array.isArray(e.data))a=e.data.map((e=>1===e.isDepartment?{...e,expanded:!1,submodules:[],departments:[],isLeaf:!0,isDepartment:1}:{...e,expanded:!1,submodules:e.submodules||[],departments:e.departments||[],isLeaf:e.isLeaf||!1,isDepartment:e.isDepartment||0}));else if("object"==typeof e.data&&null!==e.data){const t=e.data;a=1===t.isDepartment?[{...t,expanded:!1,submodules:[],departments:[],isLeaf:!0,isDepartment:1}]:[{...t,expanded:!1,submodules:t.submodules||[],departments:t.departments||[],isLeaf:t.isLeaf||!1,isDepartment:t.isDepartment||0}]}m.value=a}else k({title:"并没有找到哦~",icon:"none",duration:2e3})}catch(e){console.error("搜索请求异常:",e),k({title:"搜索请求异常",icon:"none",duration:2e3})}else f()};async function f(){await D(1,null,!0)}async function D(e,a,t=!1){if(a&&1===a.isDepartment)return;let l=await w({url:"/station/unfold",method:"GET",data:{id:parseInt(e)},header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${n}`}});if(200===l.code)if(console.log(`成功获取ID为${e}的子模块:`,l.data),l.data&&Array.isArray(l.data)){const e=l.data.map((e=>({...e,expanded:!1,submodules:[],departments:1===e.isDepartment?[]:e.departments||[],isLeaf:!1,isDepartment:e.isDepartment||0})));if(t){m.value=e;for(const a of e)1!==a.isDepartment&&await D(a.id,a)}else a&&(a.submodules=e)}else console.warn(`ID为${e}的数据不是期望的数组格式`);else 404===l.code&&(console.log(`ID为${e}的模块是最后一级菜单`),a&&(a.isLeaf=!0))}async function I(e){let a=await w({url:"/department/view",method:"GET",data:{stationId:parseInt(e)},header:{"content-type":"application/x-www-form-urlencoded",Authorization:`Bearer ${n}`}});200===a.code?(console.log("Department detail loaded successfully:",a.data),d.setDepartmentDetail(a.data),x({url:"/pages/department/detail"})):(console.error("Failed to load department detail:",a.message),k({title:a.message||"获取部门详情失败",icon:"none",duration:2e3}))}h((()=>{f(),document.querySelector(".uni-page-head-hd").style.display="none"})),a((()=>{const e=document.querySelector(".uni-page-head-hd");e&&(e.style.display="none")}));const L=()=>{},S=()=>{x({url:"/pages/paper/paper"})},q=()=>{x({url:"/pages/info/info"})};return(e,a)=>{const n=t(l("up-input"),b),d=g,f=y;return s(),o(f,{class:"department-container"},{default:r((()=>[i(f,{class:"search-box"},{default:r((()=>[i(n,{placeholder:"搜索模块或部门,宁可少字也不可错字哦~",border:"surround",modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),clearable:""},null,8,["modelValue"]),i(d,{class:"search-button",onClick:p},{default:r((()=>[u("搜索")])),_:1})])),_:1}),i(f,{class:"nav-container"},{default:r((()=>[i(A,{modules:m.value,level:1,unfoldStation:D,viewDepartmentDetail:I},null,8,["modules"])])),_:1}),i(f,{class:"tab-bar"},{default:r((()=>[i(f,{class:"tab-item active",onClick:L},{default:r((()=>[u("部门展览")])),_:1}),i(f,{class:"tab-item",onClick:S},{default:r((()=>[u("已填报")])),_:1}),i(f,{class:"tab-item",onClick:q},{default:r((()=>[u("个人中心")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-e1c0e755"]]);export{I as default};
