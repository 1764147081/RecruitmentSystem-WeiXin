{"version":3,"file":"app.js","sources":["App.vue","main.js"],"sourcesContent":["<script>\r\n\timport { createApp } from 'vue';\r\n\timport { createPinia } from 'pinia';\r\n\timport { useFirstStore } from './stores/index.js';\r\n\timport { request } from './common/request.js';\r\n\r\n\t// 创建Pinia实例\r\n\tconst pinia = createPinia();\r\n\tconst app = createApp({});\r\n\tapp.use(pinia);\r\n\r\n\texport default {\r\n\t\tonLaunch: function() {\r\n\t\t\tconsole.log('App Launch');\r\n\t\t\tthis.initLogin();\r\n\t\t},\r\n\t\tonShow: function() {\r\n\t\t\tconsole.log('App Show');\r\n\t\t},\r\n\t\tonHide: function() {\r\n\t\t\tconsole.log('App Hide');\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tinitLogin() {\r\n\t\t\t\tconst store = useFirstStore();\r\n\t\t\t\t\r\n\t\t\t\t// 检查本地存储中是否有token\r\n\t\t\t\tconst token = wx.getStorageSync('authToken') || '';\r\n\t\t\t\t\r\n\t\t\t\tif (token) {\r\n\t\t\t\t\tconsole.log('发现保存的token，尝试自动登录');\r\n\t\t\t\t\t// 先设置token\r\n\t\t\t\t\tstore.setToken(token);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 验证token有效性\r\n\t\t\t\t\trequest({\r\n\t\t\t\t\t\turl: '/user/verify-token',\r\n\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\ttoken: token\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\theader: {\r\n\t\t\t\t\t\t\t'content-type': 'application/x-www-form-urlencoded',\r\n\t\t\t\t\t\t\t'Authorization': `Bearer ${token}`\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\t\t// token有效，更新用户信息\r\n\t\t\t\t\t\t\tstore.setLoginData({\r\n\t\t\t\t\t\t\t\ttoken: token,\r\n\t\t\t\t\t\t\t\tuserInfo: res.userInfo\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 跳转到首页\r\n\t\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\t\turl: '/pages/department/department'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// token无效，清除token\r\n\t\t\t\t\t\t\tconsole.log('token无效，清除登录状态');\r\n\t\t\t\t\t\t\tstore.logout();\r\n\t\t\t\t\t\t\t// 跳转到登录页\r\n\t\t\t\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\t\t\t\turl: '/pages/login/login'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).catch(error => {\r\n\t\t\t\t\t\tconsole.error('验证token失败:', error);\r\n\t\t\t\t\t\t// 网络错误，仍然跳转到首页，但可能在首页会再次验证\r\n\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\turl: '/pages/department/department'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 没有token，跳转到登录页\r\n\t\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\t\turl: '/pages/login/login'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t/*每个页面公共css */\r\n\t@import \"@/uni_modules/uview-plus/index.scss\";\r\n</style>\r\n","import App from './App'\r\n\n\n// #ifndef VUE3\nimport Vue from 'vue'\nimport './uni.promisify.adaptor'\nVue.config.productionTip = false\nApp.mpType = 'app'\nconst app = new Vue({\n  ...App\n})\napp.$mount()\n// #endif\nimport uviewPlus from '@/uni_modules/uview-plus'\r\n\n// #ifdef VUE3\nimport { createSSRApp } from 'vue'\r\nimport { createPinia } from 'pinia'\nexport function createApp() {\n  const app = createSSRApp(App);\r\n  const pinia = createPinia();\r\n  app.use(pinia)\r\n  app.use(uviewPlus)\n  return {\n    app,\r\n\tpinia,\n  };\n}\n// #endif"],"names":["createPinia","createApp","uni","useFirstStore","wx","request","app","createSSRApp","App","pinia","uviewPlus"],"mappings":";;;;;;;;;;;;;;;AAOC,MAAM,QAAQA,cAAAA;AACd,MAAM,MAAMC,wBAAU,CAAA,CAAE;AACxB,IAAI,IAAI,KAAK;AAEb,MAAK,YAAU;AAAA,EACd,UAAU,WAAW;AACpBC,kBAAAA,MAAA,MAAA,OAAA,iBAAY,YAAY;AACxB,SAAK,UAAS;AAAA,EACd;AAAA,EACD,QAAQ,WAAW;AAClBA,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAAA,EACtB;AAAA,EACD,QAAQ,WAAW;AAClBA,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAAA,EACtB;AAAA,EACD,SAAS;AAAA,IACR,YAAY;AACX,YAAM,QAAQC,aAAAA;AAGd,YAAM,QAAQC,cAAE,KAAC,eAAe,WAAW,KAAK;AAEhD,UAAI,OAAO;AACVF,sBAAAA,MAAA,MAAA,OAAA,iBAAY,mBAAmB;AAE/B,cAAM,SAAS,KAAK;AAGpBG,+BAAQ;AAAA,UACP,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAM;AAAA,YACL;AAAA,UACA;AAAA,UACD,QAAQ;AAAA,YACP,gBAAgB;AAAA,YAChB,iBAAiB,UAAU,KAAK;AAAA,UACjC;AAAA,SACA,EAAE,KAAK,SAAO;AACd,cAAI,IAAI,SAAS,KAAK;AAErB,kBAAM,aAAa;AAAA,cAClB;AAAA,cACA,UAAU,IAAI;AAAA,YACf,CAAC;AAGDH,0BAAAA,MAAI,UAAU;AAAA,cACb,KAAK;AAAA,YACN,CAAC;AAAA,iBACK;AAENA,0BAAAA,MAAY,MAAA,OAAA,iBAAA,gBAAgB;AAC5B,kBAAM,OAAM;AAEZA,0BAAAA,MAAI,WAAW;AAAA,cACd,KAAK;AAAA,YACN,CAAC;AAAA,UACF;AAAA,QACD,CAAC,EAAE,MAAM,WAAS;AACjBA,wBAAc,MAAA,MAAA,SAAA,iBAAA,cAAc,KAAK;AAEjCA,wBAAAA,MAAI,UAAU;AAAA,YACb,KAAK;AAAA,UACN,CAAC;AAAA,QACF,CAAC;AAAA,aACK;AAENA,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAK;AAAA,QACN,CAAC;AAAA,MACF;AAAA,IACD;AAAA,EACD;AACD;AC/DM,SAAS,YAAY;AAC1B,QAAMI,OAAMC,2BAAaC,SAAG;AAC5B,QAAMC,SAAQT,cAAAA;AACd,EAAAM,KAAI,IAAIG,MAAK;AACb,EAAAH,KAAI,IAAII,qCAAS;AACjB,SAAO;AAAA,IACL,KAAAJ;AAAA,IACH,OAAAG;AAAA,EACD;AACA;;;"}