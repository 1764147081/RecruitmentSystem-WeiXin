{"version":3,"file":"department.js","sources":["pages/department/department.vue","E:/000Work/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZGVwYXJ0bWVudC9kZXBhcnRtZW50LnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"department-container\">\r\n\t\t<!-- 搜索框 -->\r\n\t\t<view class=\"search-box\">\r\n\t\t\t<up-input placeholder=\"搜索模块或部门\" border=\"surround\" v-model=\"searchKey\" clearable></up-input>\r\n\t\t</view>\r\n\r\n\t\t<!-- 导航栏 -->\r\n\t\t<view class=\"nav-container\">\r\n\t\t\t<!-- 递归渲染模块 -->\r\n\t\t\t<RecursiveModule :modules=\"modules\" :level=\"1\" :unfoldStation=\"unfoldStation\" :viewDepartmentDetail=\"viewDepartmentDetail\" />\r\n\t\t</view>\r\n\r\n\t\t<!-- 底部导航 -->\r\n\t\t<view class=\"tab-bar\">\r\n\t\t\t<view class=\"tab-item active\" @click=\"navigateToDepartment\">部门展览</view>\r\n\t\t\t<view class=\"tab-item\" @click=\"navigateToPaper\">已填报</view>\r\n\t\t\t<view class=\"tab-item\" @click=\"navigateToInfo\">个人中心</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, watch } from 'vue';\r\n\timport { onLoad, onShow } from '@dcloudio/uni-app';\r\n\timport { useFirstStore } from '@/stores/index.js';\r\n\timport { request } from '../../common/request';\r\n    import RecursiveModule from '../../components/RecursiveModule/RecursiveModule.vue';\r\n\r\n\tconst token = wx.getStorageSync('authToken');\r\n\tconst store = useFirstStore();\r\n\tconst modules = ref([]);\r\n\tconst searchKey = ref('');\r\n\tconst originalModules = ref([]); // 存储原始数据\r\n\r\n\t// 监听搜索关键词变化\r\n\twatch(searchKey, (newValue) => {\r\n\t\tif (!newValue) {\r\n\t\t\t// 如果搜索框为空，恢复原始数据\r\n\t\t\tmodules.value = [...originalModules.value];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// 根据搜索关键词过滤数据\r\n\t\tconst filteredModules = originalModules.value.map(module => {\r\n\t\t\t// 过滤模块下的子模块\r\n\t\t\tconst filteredSubmodules = module.submodules.filter(submodule => {\r\n\t\t\t\t// 过滤子模块下的部门\r\n\t\t\t\tconst filteredDepartments = submodule.departments.filter(department =>\r\n\t\t\t\t\tdepartment.name.toLowerCase().includes(newValue.toLowerCase())\r\n\t\t\t\t);\r\n\r\n\t\t\t\treturn filteredDepartments.length > 0;\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...module,\r\n\t\t\t\tsubmodules: filteredSubmodules\r\n\t\t\t};\r\n\t\t}).filter(module => module.submodules.length > 0);\r\n\r\n\t\tmodules.value = filteredModules;\r\n\t});\r\n\r\n\t// 切换模块展开/折叠状态\r\n\tconst toggleModule = (module) => {\r\n\t\tmodule.expanded = !module.expanded;\r\n\r\n\t\t// 如果展开模块，确保已加载其子数据\r\n\t\tif (module.expanded && module.submodules && module.submodules.length === 0) {\r\n\t\t\tunfoldStation(module.id, module);\r\n\t\t}\r\n\t};\r\n\r\n\tasync function ViewStation() {\r\n\t\t// 初始加载根目录 id=0\r\n\t\tawait unfoldStation(0, null, true);\r\n\t}\r\n\r\n\t// 递归展开子模块\r\n\tasync function unfoldStation(id, parentModule, isRoot = false) {\r\n\t\tlet res = await request({\r\n\t\t\turl: '/station/unfold',\r\n\t\t\tmethod: 'GET',\r\n\t\t\tdata: {\r\n\t\t\t\tid: parseInt(id),\r\n\t\t\t},\r\n\t\t\theader: {\r\n\t\t\t\t'content-type': 'application/x-www-form-urlencoded',\r\n\t\t\t\t'Authorization': `Bearer ${token}`\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (res.code === 200) {\r\n\t\t\tconsole.log(`成功获取ID为${id}的子模块:`, res.data);\r\n\r\n\t\t\t// 确保数据结构正确\r\n\t\t\tif (res.data && Array.isArray(res.data)) {\r\n\t\t\t\tconst formattedData = res.data.map(item => ({\r\n\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\texpanded: false, // 默认折叠\r\n\t\t\t\t\t\tsubmodules: [],\r\n\t\t\t\t\t\tdepartments: item.departments || [],\r\n\t\t\t\t\t\tisLeaf: false // 标记是否为最后一级菜单\r\n\t\t\t\t\t}));\r\n\r\n\t\t\t\tif (isRoot) {\r\n\t\t\t\t\t// 根节点数据\r\n\t\t\t\t\tmodules.value = formattedData;\r\n\t\t\t\t\toriginalModules.value = [...formattedData];\r\n\r\n\t\t\t\t\t// 为根节点加载子模块\r\n\t\t\t\t\tfor (const item of formattedData) {\r\n\t\t\t\t\t\tawait unfoldStation(item.id, item);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (parentModule) {\r\n\t\t\t\t\t// 将子模块添加到父模块\r\n\t\t\t\t\tparentModule.submodules = formattedData;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn(`ID为${id}的数据不是期望的数组格式`);\r\n\t\t\t}\r\n\t\t} else if (res.code === 404) {\r\n\t\t\t// 标记为最后一级菜单\r\n\t\t\tconsole.log(`ID为${id}的模块是最后一级菜单`);\r\n\t\t\tif (parentModule) {\r\n\t\t\t\tparentModule.isLeaf = true;\r\n\t\t\t}\r\n\t\t} \r\n\r\n\t\t\r\n\t}\r\n\r\n\tonLoad(() => {\r\n\t\tViewStation();\r\n\t})\r\n\r\n\t// 查看部门详情\r\n\t// async function viewDepartmentDetail(departmentId) {\r\n\t// \tlet res = await request({\r\n\t// \t\turl: '/station/view',\r\n\t// \t\tmethod: 'GET',\r\n\t// \t\tdata: {\r\n\t// \t\t\tid: parseInt(departmentId),\r\n\t// \t\t},\r\n\t// \t\theader: {\r\n\t// \t\t\t'content-type': 'application/x-www-form-urlencoded',\r\n\t// \t\t\t'Authorization': `Bearer ${token}`\r\n\t// \t\t}\r\n\t// \t});\r\n\t// \tif (res.code === 200) {\r\n\t// \t\tconsole.log('Department detail loaded successfully:', res.data);\r\n\t// \t\t// 跳转到详情页并传递数据\r\n\t// \t\tuni.navigateTo({\r\n\t// \t\t\turl: `/pages/department/detail?id=${departmentId}`\r\n\t// \t\t});\r\n\t// \t} else {\r\n\t// \t\tconsole.error('Failed to load department detail:', res.message);\r\n\t// \t\tuni.showToast({\r\n\t// \t\t\ttitle: res.message || '获取部门详情失败',\r\n\t// \t\t\ticon: 'none',\r\n\t// \t\t\tduration: 2000\r\n\t// \t\t});\r\n\t// \t}\r\n\t// }\r\n\r\n\t// 跳转到部门列表\r\n\tconst navigateToDepartment = () => {\r\n\t\t// 当前页面，不需要跳转\r\n\t};\r\n\r\n\t// 跳转到已填报页面\r\n\tconst navigateToPaper = () => {\r\n\t\tuni.navigateTo({\r\n\t\t\turl: '/pages/paper/paper'\r\n\t\t});\r\n\t};\r\n\r\n\t// 跳转到个人中心\r\n\tconst navigateToInfo = () => {\r\n\t\tuni.navigateTo({\r\n\t\t\turl: '/pages/info/info'\r\n\t\t});\r\n\t};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t.department-container {\r\n\t\tpadding: 20rpx;\r\n\t\tpadding-bottom: 120rpx;\r\n\t\tbackground-color: #f5f5f5;\r\n\t\tmin-height: 100vh;\r\n\t}\r\n\r\n\t.tab-bar {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-around;\r\n\t\talign-items: center;\r\n\t\theight: 100rpx;\r\n\t\tbackground-color: #fff;\r\n\t\tborder-top: 1rpx solid #eee;\r\n\t\tposition: fixed;\r\n\t\tbottom: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t}\r\n\r\n\t.tab-item {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #999;\r\n\t\ttext-align: center;\r\n\t\tpadding: 10rpx 0;\r\n\t}\r\n\r\n\t.tab-item.active {\r\n\t\tcolor: #e63946;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t.search-box {\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\r\n\t.nav-container {\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 16rpx;\r\n\t\tbox-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t.module-item {\r\n\t\tborder-bottom: 1rpx solid #eee;\r\n\t}\r\n\r\n\t.module-header {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tpadding: 30rpx 20rpx;\r\n\t\tfont-size: 32rpx;\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.submodule-list {\r\n\t\tpadding-left: 40rpx;\r\n\t\tbackground-color: #f9f9f9;\r\n\t}\r\n\r\n\t.submodule-item {\r\n\t\tborder-bottom: 1rpx solid #eee;\r\n\t}\r\n\r\n\t.submodule-header {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tpadding: 25rpx 20rpx;\r\n\t\tfont-size: 30rpx;\r\n\t\tcolor: #666;\r\n\t}\r\n\r\n\t.department-list {\r\n\t\tpadding-left: 40rpx;\r\n\t\tbackground-color: #f0f0f0;\r\n\t}\r\n\r\n\t.department-item {\r\n\tpadding: 20rpx;\r\n\tfont-size: 28rpx;\r\n\tcolor: #666;\r\n\tborder-bottom: 1rpx solid #eee;\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\talign-items: center;\r\n}\r\n\r\n/* 递归模块样式 */\r\n.level-1 .module-header {\r\n\tpadding-left: 20rpx;\r\n}\r\n.level-2 .module-header {\r\n\tpadding-left: 60rpx;\r\n}\r\n.level-3 .module-header {\r\n\tpadding-left: 100rpx;\r\n}\r\n.level-4 .module-header {\r\n\tpadding-left: 140rpx;\r\n}\r\n.level-5 .module-header {\r\n\tpadding-left: 180rpx;\r\n}\r\n\r\n/* 增加更多层级的样式，如果需要 */\r\n.level-6 .module-header {\r\n\tpadding-left: 220rpx;\r\n}\r\n.level-7 .module-header {\r\n\tpadding-left: 260rpx;\r\n}\r\n.level-8 .module-header {\r\n\tpadding-left: 300rpx;\r\n}\r\n.level-9 .module-header {\r\n\tpadding-left: 340rpx;\r\n}\r\n.level-10 .module-header {\r\n\tpadding-left: 380rpx;\r\n}\r\n\r\n/* 子模块列表样式 */\r\n.submodule-list {\r\n\tbackground-color: #f9f9f9;\r\n}\r\n\r\n/* 部门列表样式 */\r\n.department-list {\r\n\tpadding-left: 40rpx;\r\n\tbackground-color: #f0f0f0;\r\n}\r\n\r\n/* 箭头图标样式 */\r\n.arrow-icon {\r\n\tfont-size: 24rpx;\r\n\tcolor: #999;\r\n}\r\n\r\n/* 右箭头样式 */\r\n.arrow-right {\r\n\tfont-size: 24rpx;\r\n\tcolor: #999;\r\n\tmargin-left: auto;\r\n}\r\n\r\n\t.arrow-right {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.arrow-icon {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n</style>","import MiniProgramPage from 'C:/Users/1764147081/Desktop/new/RecruitmentSystem-WeiXin/RecruitmentSystem-WeiXin/pages/department/department.vue'\nwx.createPage(MiniProgramPage)"],"names":["wx","useFirstStore","ref","watch","request","uni","onLoad","MiniProgramPage"],"mappings":";;;;;;;;;;;;AA2BI,MAAM,kBAAkB,MAAW;;;;AAEtC,UAAM,QAAQA,cAAAA,KAAG,eAAe,WAAW;AAC7BC,+BAAgB;AAC9B,UAAM,UAAUC,kBAAI,CAAA,CAAE;AACtB,UAAM,YAAYA,kBAAI,EAAE;AACxB,UAAM,kBAAkBA,kBAAI,CAAA,CAAE;AAG9BC,wBAAM,WAAW,CAAC,aAAa;AAC9B,UAAI,CAAC,UAAU;AAEd,gBAAQ,QAAQ,CAAC,GAAG,gBAAgB,KAAK;AACzC;AAAA,MACA;AAGD,YAAM,kBAAkB,gBAAgB,MAAM,IAAI,YAAU;AAE3D,cAAM,qBAAqB,OAAO,WAAW,OAAO,eAAa;AAEhE,gBAAM,sBAAsB,UAAU,YAAY;AAAA,YAAO,gBACxD,WAAW,KAAK,YAAW,EAAG,SAAS,SAAS,aAAa;AAAA,UAClE;AAEI,iBAAO,oBAAoB,SAAS;AAAA,QACxC,CAAI;AAED,eAAO;AAAA,UACN,GAAG;AAAA,UACH,YAAY;AAAA,QAChB;AAAA,MACA,CAAG,EAAE,OAAO,YAAU,OAAO,WAAW,SAAS,CAAC;AAEhD,cAAQ,QAAQ;AAAA,IAClB,CAAE;AAYD,mBAAe,cAAc;AAE5B,YAAM,cAAc,GAAG,MAAM,IAAI;AAAA,IACjC;AAGD,mBAAe,cAAc,IAAI,cAAc,SAAS,OAAO;AAC9D,UAAI,MAAM,MAAMC,uBAAQ;AAAA,QACvB,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,IAAI,SAAS,EAAE;AAAA,QACf;AAAA,QACD,QAAQ;AAAA,UACP,gBAAgB;AAAA,UAChB,iBAAiB,UAAU,KAAK;AAAA,QAChC;AAAA,MACJ,CAAG;AAED,UAAI,IAAI,SAAS,KAAK;AACrBC,sBAAAA,MAAY,MAAA,OAAA,yCAAA,UAAU,EAAE,SAAS,IAAI,IAAI;AAGzC,YAAI,IAAI,QAAQ,MAAM,QAAQ,IAAI,IAAI,GAAG;AACxC,gBAAM,gBAAgB,IAAI,KAAK,IAAI,WAAS;AAAA,YAC1C,GAAG;AAAA,YACH,UAAU;AAAA;AAAA,YACV,YAAY,CAAE;AAAA,YACd,aAAa,KAAK,eAAe,CAAE;AAAA,YACnC,QAAQ;AAAA;AAAA,UACR,EAAC;AAEH,cAAI,QAAQ;AAEX,oBAAQ,QAAQ;AAChB,4BAAgB,QAAQ,CAAC,GAAG,aAAa;AAGzC,uBAAW,QAAQ,eAAe;AACjC,oBAAM,cAAc,KAAK,IAAI,IAAI;AAAA,YACjC;AAAA,UACD,WAAU,cAAc;AAExB,yBAAa,aAAa;AAAA,UAC1B;AAAA,QACL,OAAU;AACNA,8BAAA,MAAA,QAAA,0CAAa,MAAM,EAAE,cAAc;AAAA,QACnC;AAAA,MACJ,WAAa,IAAI,SAAS,KAAK;AAE5BA,4BAAA,MAAA,OAAA,0CAAY,MAAM,EAAE,YAAY;AAChC,YAAI,cAAc;AACjB,uBAAa,SAAS;AAAA,QACtB;AAAA,MACD;AAAA,IAGD;AAEDC,kBAAAA,OAAO,MAAM;AACZ;IACF,CAAE;AAgCD,UAAM,uBAAuB,MAAM;AAAA,IAEpC;AAGC,UAAM,kBAAkB,MAAM;AAC7BD,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK;AAAA,MACR,CAAG;AAAA,IACH;AAGC,UAAM,iBAAiB,MAAM;AAC5BA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK;AAAA,MACR,CAAG;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;ACtLA,GAAG,WAAWE,SAAe;"}