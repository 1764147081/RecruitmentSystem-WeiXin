{"version":3,"file":"edit.js","sources":["pages/info/edit.vue","E:/000Work/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5mby9lZGl0LnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"edit-container\">\r\n\t\t<view class=\"page-title\">\r\n\t\t\t<text>编辑个人信息</text>\r\n\t\t</view>\r\n\r\n\t\t<view class=\"avatar-container\">\r\n\t\t\t<image class=\"avatar\" :src=\"previewImage || userInfo.avatar || '/static/assets/logo.png'\" mode=\"aspectFill\"></image>\r\n\t\t\t<view class=\"upload-btn\" @click=\"uploadAvatar\">\r\n\t\t\t\t<text>上传头像</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\r\n\t\t<view class=\"form-list\">\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"form-label\">姓名</text>\r\n\t\t\t\t<input class=\"form-input form-input-readonly\" v-model=\"userInfo.name\" placeholder=\"请输入姓名\" readonly />\r\n\t\t\t</view>\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"form-label\">个人描述</text>\r\n\t\t\t\t<input class=\"form-input\" v-model=\"userInfo.profile\" placeholder=\"请输入个人描述\" />\r\n\t\t\t</view>\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"form-label\">学院</text>\r\n\t\t\t\t<input class=\"form-input form-input-readonly\" v-model=\"userInfo.depart\" placeholder=\"请输入学院\" readonly />\r\n\t\t\t</view>\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"form-label\">专业</text>\r\n\t\t\t\t<input class=\"form-input\" v-model=\"userInfo.major\" placeholder=\"请输入专业\" />\r\n\t\t\t</view>\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"form-label\">邮箱</text>\r\n\t\t\t\t<input class=\"form-input\" v-model=\"userInfo.email\" placeholder=\"请输入邮箱\" type=\"email\" />\r\n\t\t\t</view>\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"form-label\">QQ</text>\r\n\t\t\t\t<input class=\"form-input\" v-model=\"userInfo.qq\" placeholder=\"请输入QQ\" />\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<view class=\"password-btn\" @click=\"toSetPassword\">\r\n\t\t\t<text>设置密码</text>\r\n\t\t</view>\r\n\r\n\t\t<view class=\"save-btn\" @click=\"saveAndReturn\">\r\n\t\t\t<text>保存并返回</text>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\trequest\r\n\t} from '../../common/request';\r\n\timport { baseUrl } from '../../common/request';\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tuserInfo: {\r\n\t\t\t\t\tname: '',\r\n\t\t\t\t\tprofile: '',\r\n\t\t\t\t\tdepart: '',\r\n\t\t\t\t\tmajor: '',\r\n\t\t\t\t\temail: '',\r\n\t\t\t\t\tqq: '',\r\n\t\t\t\t\tavatar: ''\r\n\t\t\t\t},\r\n\t\t\t\tpreviewImage: '' // 用于头像预览\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\t// 加载用户信息\r\n\t\t\tthis.getUserInfo();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\ttoSetPassword() {\r\n\t\t\t\t// 跳转到设置密码页面\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/info/setPassword'\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tasync saveAndReturn() {\r\n\t\t\t\t// 保存用户信息\r\n\t\t\t\tconst token = wx.getStorageSync('authToken');\r\n\t\t\t\tconst response = await request({\r\n\t\t\t\t\turl: '/user/update/info',\r\n\t\t\t\t\tmethod: 'PUT',\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t\t\t'Authorization': `Bearer ${token}`\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdata: JSON.stringify({\r\n\t\t\t\t\t\tname: this.userInfo.name,\r\n\t\t\t\t\t\tprofile: this.userInfo.profile,\r\n\t\t\t\t\t\tdepart: this.userInfo.depart,\r\n\t\t\t\t\t\tmajor: this.userInfo.major,\r\n\t\t\t\t\t\temail: this.userInfo.email,\r\n\t\t\t\t\t\tqq: this.userInfo.qq\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (response.code === 200) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '保存成功',\r\n\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\tduration: 2000,\r\n\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tuni.navigateBack();\r\n\t\t\t\t\t\t\t}, 2000);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: response.data.message || '保存失败',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tasync getUserInfo() {\r\n\t\t\t\tconst token = wx.getStorageSync('authToken');\r\n\t\t\t\tconst response = await request({\r\n\t\t\t\t\turl: '/user/info',\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\t'content-type': 'application/x-www-form-urlencoded',\r\n\t\t\t\t\t\t'Authorization': `Bearer ${token}`\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (response.data) {\r\n\t\t\t\t\tthis.userInfo = {\r\n\t\t\t\t\t\tname: response.data.name || '',\r\n\t\t\t\t\t\tprofile: response.data.profile || '',\r\n\t\t\t\t\t\tdepart: response.data.depart || '',\r\n\t\t\t\t\t\tmajor: response.data.major || '',\r\n\t\t\t\t\t\temail: response.data.email || '',\r\n\t\t\t\t\t\tqq: response.data.qq || '',\r\n\t\t\t\t\t\tavatar: response.data.avatar || ''\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\r\n\t\t\tclosePreview() {\r\n\t\t\t\tthis.previewImage = '';\r\n\t\t\t},\r\n\t\t\tuploadAvatar() {\r\n\t\t\t\t// 选择图片\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tcount: 1,\r\n\t\t\t\t\tsizeType: ['compressed'],\r\n\t\t\t\t\tsourceType: ['album', 'camera'],\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t// 检查文件大小是否超过10MB\r\n\t\t\t\t\t\tconst file = res.tempFiles[0];\r\n\t\t\t\t\t\tconst MAX_SIZE = 10 * 1024 * 1024; // 10MB\r\n\r\n\t\t\t\t\t\tif (file.size > MAX_SIZE) {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '文件大小不能超过10MB',\r\n\t\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconst tempFilePath = res.tempFilePaths[0];\r\n\t\t\t\t\t// 设置预览图片路径\r\n\t\t\t\t\tthis.previewImage = tempFilePath;\r\n\t\t\t\t\t// 上传图片\r\n\t\t\t\t\tthis.uploadFile(tempFilePath);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tasync uploadFile(filePath) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst token = wx.getStorageSync('authToken');\r\n\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\ttitle: '上传中...'\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tconst response = await new Promise((resolve, reject) => {\r\n\t\t\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\t\t\t\turl: baseUrl + '/user/upload/avatar',\r\n\t\t\t\t\t\t\t\tfilePath: filePath,\r\n\t\t\t\t\t\t\t\tname: 'file',\r\n\t\t\t\t\t\t\t\theader: {\r\n\t\t\t\t\t\t\t\t\t'Authorization': `Bearer ${token}`,\r\n\t\t\t\t\t\t\t\t\t'content-type': 'multipart/form-data'\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tsuccess: (uploadRes) => {\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tconst data = JSON.parse(uploadRes.data);\r\n\t\t\t\t\t\t\t\t\tresolve(data);\r\n\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\treject(new Error('上传失败，响应格式不正确'));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (response.code === 200) {\r\n\t\t\t\t\t\t// 更新头像\r\n\t\t\t\t\t\tthis.userInfo.avatar = response.data.avatarUrl;\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '上传成功',\r\n\t\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: response.message || '上传失败',\r\n\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error('上传头像失败:', error);\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '上传失败，请重试',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style scoped>\r\n\t.edit-container {\r\n\t\tpadding: 20rpx;\r\n\t\tbackground-color: #f5f5f5;\r\n\t\tmin-height: 100vh;\r\n\t}\r\n\r\n\t.page-title {\r\n\t\ttext-align: center;\r\n\t\tfont-size: 36rpx;\r\n\t\tfont-weight: bold;\r\n\t\tpadding: 30rpx 0;\r\n\t\tbackground-color: #fff;\r\n\t\tmargin-bottom: 20rpx;\r\n\t\tborder-radius: 16rpx;\r\n\t\tbox-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t.avatar-container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tbackground-color: #fff;\r\n\t\tpadding: 30rpx 0;\r\n\t\tborder-radius: 16rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t\tbox-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t.avatar {\r\n\t\twidth: 200rpx;\r\n\t\theight: 200rpx;\r\n\t\tborder-radius: 50%;\r\n\t\tmargin-bottom: 20rpx;\r\n\t\tborder: 2rpx solid #eee;\r\n\t}\r\n\r\n\t.upload-btn {\r\n\t\tbackground-color: #007aff;\r\n\t\tpadding: 15rpx 40rpx;\r\n\t\tborder-radius: 50rpx;\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #fff;\r\n\t}\r\n\r\n\t.form-list {\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 16rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t\tbox-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t.form-item {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tpadding: 30rpx 20rpx;\r\n\t\tborder-bottom: 1rpx solid #eee;\r\n\t}\r\n\r\n\t.form-item:last-child {\r\n\t\tborder-bottom: none;\r\n\t}\r\n\r\n\t.form-label {\r\n\t\tfont-size: 30rpx;\r\n\t\tcolor: #333;\r\n\t\twidth: 180rpx;\r\n\t}\r\n\r\n\t.form-input {\r\n\t\t\tflex: 1;\r\n\t\t\tfont-size: 30rpx;\r\n\t\t\tcolor: #666;\r\n\t\t}\r\n\r\n\t\t.form-input-readonly {\r\n\t\t\tflex: 1;\r\n\t\t\tfont-size: 30rpx;\r\n\t\t\tcolor: #999;\r\n\t\t\tbackground-color: #f5f5f5;\r\n\t\t\tcursor: not-allowed;\r\n\t\t}\r\n\r\n\t.password-btn {\r\n\t\tbackground-color: #007aff;\r\n\t\ttext-align: center;\r\n\t\tpadding: 30rpx 0;\r\n\t\tborder-radius: 16rpx;\r\n\t\tfont-size: 32rpx;\r\n\t\tcolor: #fff;\r\n\t\tbox-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.1);\r\n\t\tmargin-top: 20rpx;\r\n\t}\r\n\r\n\t.save-btn {\r\n\t\tbackground-color: #e64340;\r\n\t\ttext-align: center;\r\n\t\tpadding: 30rpx 0;\r\n\t\tborder-radius: 16rpx;\r\n\t\tfont-size: 32rpx;\r\n\t\tcolor: #fff;\r\n\t\tbox-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.1);\r\n\t\tmargin-top: 20rpx;\r\n\t}\r\n\t\r\n</style>","import MiniProgramPage from 'C:/Users/1764147081/Desktop/new/RecruitmentSystem-WeiXin/RecruitmentSystem-WeiXin/pages/info/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","wx","request","baseUrl"],"mappings":"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"}