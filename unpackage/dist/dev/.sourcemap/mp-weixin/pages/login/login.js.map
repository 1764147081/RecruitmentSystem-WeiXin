{"version":3,"file":"login.js","sources":["pages/login/login.vue","E:/000Work/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n\t<Toast position=\"top\" class=\"top-toast\"></Toast>\r\n\t<view class=\"background\">\r\n\t\t<image src=\"/static/assets/SDU.png\" alt=\"\">\r\n\t\t</image>\r\n\r\n\t</view>\r\n\t<view class=\"logo\">\r\n\t\t<image src=\"/static/assets/logo.png\" alt=\"\" mode=\"widthFix\"></image>\r\n\t</view>\r\n\t<view class=\"container\">\r\n\t\t<view class=\"login-tabs\">\r\n\t\t\t<view class=\"tab-btn\" :class=\"{active: loginType === 'password'}\" @click=\"switchLoginType('password')\">\r\n\t\t\t\t账号密码登录</view>\r\n\t\t\t<view class=\"tab-btn\" :class=\"{active: loginType === 'unified'}\" @click=\"switchLoginType('unified')\">统一认证登录\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view>\r\n\t\t\t<view class=\"form-login\">\r\n\t\t\t\t<form @submit.prevent=\"login\">\r\n\t\t\t\t\t<up-input class=\"input\" placeholder=\"请输入学号\" border=\"surround\" v-model=\"stuID\" clearable></up-input>\r\n\r\n\t\t\t\t\t<up-input class=\"input\" placeholder=\"请输入密码\" border=\"surround\" v-model=\"password\" clearable\r\n\t\t\t\t\t\tpassword></up-input>\r\n\t\t\t\t\t<view v-if=\"showCaptcha\" class=\"captcha-container\">\r\n\t\t\t\t\t\t<up-input class=\"input captcha-input\" placeholder=\"请输入验证码\" border=\"surround\"\r\n\t\t\t\t\t\t\tv-model=\"captchaCode\" clearable type=\"number\" maxlength=\"6\"></up-input>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"checkbox-and-register\">\r\n\t\t\t\t\t\t<up-checkbox :customStyle=\"{marginBottom: '5px'}\" label=\"自动登录\" name=\"agree\" usedAlone\r\n\t\t\t\t\t\t\tv-model:checked=\"aloneChecked\">\r\n\t\t\t\t\t\t</up-checkbox>\r\n\t\t\t\t\t\t<view class=\"register-link\" @click=\"goToUnifiedLogin\">注册</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<button class=\"button-form\"\r\n\t\t\t\t\t\t@click=\"login()\">{{ loginType === 'password' ? '账号密码登录' : '统一认证登录' }}</button>\r\n\t\t\t\t</form>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tonMounted,\r\n\t\tonUnmounted\r\n\t} from 'vue';\r\n\timport {\r\n\t\tuseFirstStore\r\n\t} from \"@/stores/index.js\";\r\n\timport {\r\n\t\trequest\r\n\t} from '../../common/request.js';\r\n\tconst store = useFirstStore();\r\n\tconst stuID = ref('');\r\n\tconst password = ref('');\r\n\tconst aloneChecked = ref(false);\r\n\tconst loginType = ref('password'); // 默认账号密码登录\r\n\tconst captchaCode = ref('');\r\n\tconst showCaptcha = ref(false); // 控制验证码输入框显示\r\n\r\n\r\n\r\n\tonMounted(() => {\r\n\t\tif (store.isLoggedIn.value) {\r\n\t\t\tconsole.log('用户已登录，跳转到首页');\r\n\t\t\tuni.switchTab({\r\n\t\t\t\turl: '/pages/department/department'\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t// 切换登录类型\r\n\tfunction switchLoginType(type) {\r\n\t\tloginType.value = type;\r\n\t\t// 切换登录类型时清空验证码\r\n\t\tcaptchaCode.value = '';\r\n\t}\r\n\r\n\t// 跳转到统一认证登录\r\n\tfunction goToUnifiedLogin() {\r\n\t\tswitchLoginType('unified');\r\n\t}\r\n\r\n\tasync function login() {\r\n\t\t\t// 验证参数值\r\n\t\t\tconsole.log('stuID:', stuID.value);\r\n\t\t\tconsole.log('password:', password.value);\r\n\r\n\t\t\t// 重置验证码显示状态\r\n\t\t\tif (loginType.value === 'unified') {\r\n\t\t\t\tshowCaptcha.value = false;\r\n\t\t\t}\r\n\r\n\t\t\tlet response;\r\n\t\t\tif (loginType.value === 'unified') {\r\n\t\t\t\tconsole.log(\"现在使用统一认证登录\");\r\n\t\t\t\tconst requestData = {\r\n\t\t\t\t\tstudentNumber: stuID.value,\r\n\t\t\t\t\tpassword: password.value,\r\n\t\t\t\t\tfingerprint: stuID.value\r\n\t\t\t\t};\r\n\t\t\t\t// 只有在需要时才发送验证码\r\n\t\t\t\tif (captchaCode.value) {\r\n\t\t\t\t\trequestData.captcha = captchaCode.value;\r\n\t\t\t\t}\r\n\t\t\t\tresponse = await request({\r\n\t\t\t\t\turl: \"/user/login/cas\",\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tdata: requestData,\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\t'content-type': 'application/x-www-form-urlencoded'\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"现在使用账号密码登录\");\r\n\t\t\t\tresponse = await request({\r\n\t\t\t\t\turl: \"/user/login\",\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tstudentNumber: stuID.value,\r\n\t\t\t\t\t\tpassword: password.value\r\n\t\t\t\t\t},\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\t'content-type': 'application/x-www-form-urlencoded'\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t};\r\n\t\t\t\r\n\r\n\t\t\t\r\n\t\t\t// 处理响应\r\n\t\t\tif (response.code === 200) {\r\n\t\t\t\tconst token = response.data;\r\n\t\t\t\tconsole.log('Login successful, token:', token);\r\n\t\t\t\t// 根据用户是否选择“记住我”来存储token\r\n\t\t\t\tif (aloneChecked.value) {\r\n\t\t\t\t\t// 长期存储\r\n\t\t\t\t\twx.setStorageSync('authToken', token);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 会话级存储\r\n\t\t\t\t\twx.setStorageSync('authToken', token);\r\n\t\t\t\t}\r\n\t\t\t\t// 更新Pinia中的登录状态\r\n\t\t\t\tstore.setLoginData({\r\n\t\t\t\t\ttoken: token,\r\n\t\t\t\t\tuserInfo: response.data.userInfo\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// 跳转到首页\r\n\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\turl: '/pages/department/department'\r\n\t\t\t\t});\r\n\t\t\t} else if (response.code === 400) {\r\n\t\t\t\t// 检查是否需要验证码\r\n\t\t\t\tif (response.msg === \"需要验证码\") {\r\n\t\t\t\t\tshowCaptcha.value = true;\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '请输入验证码',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tposition: 'top'\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: response.msg || '登录失败',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tposition: 'top'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// 其他错误情况\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: response.msg || '登录失败',\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\tposition: 'top'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t.sdu {\r\n\t\tfont-size: 12px;\r\n\t\tposition: relative;\r\n\t\tright: 0;\r\n\t}\r\n\r\n\t.button-form {\r\n\t\topacity: 1;\r\n\t\tborder-radius: 8.72px;\r\n\t\tbackground: rgba(165, 0, 1, 1);\r\n\t\tborder: 2.62px solid rgba(214, 214, 214, 1);\r\n\t\tmargin-top: 20px;\r\n\t\tfont-size: 15px;\r\n\t\tcolor: rgba(252, 252, 252, 1);\r\n\r\n\t}\r\n\r\n\t.checkbox {\r\n\t\tpadding-top: 20px;\r\n\t\tfont-weight: bold;\r\n\t\tfont-size: 5px;\r\n\t}\r\n\r\n\t.checkbox-and-register {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\twidth: 100%;\r\n\t\tpadding-top: 20px;\r\n\t}\r\n\r\n\t.register-link {\r\n\t\tcolor: rgba(165, 0, 1, 1);\r\n\t\tfont-size: 14px;\r\n\t\tcursor: pointer;\r\n\t}\r\n\r\n\t// .captcha-container {\r\n\t// \tdisplay: flex;\r\n\t// \talign-items: center;\r\n\t// \tmargin-top: 20px;\r\n\t// }\r\n\r\n\t.captcha-input {\r\n\t\tflex: 1;\r\n\t\tmargin-right: 10px;\r\n\t}\r\n\r\n\t.send-captcha-btn {\r\n\t\twidth: 120px;\r\n\t\theight: 40px;\r\n\t\tbackground-color: #007aff;\r\n\t\tcolor: white;\r\n\t\tborder: none;\r\n\t\tborder-radius: 8px;\r\n\t\tfont-size: 14px;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.send-captcha-btn:disabled {\r\n\t\tbackground-color: #cccccc;\r\n\t\tcolor: #666666;\r\n\t\tcursor: not-allowed;\r\n\t}\r\n\r\n\t.form-login {\r\n\t\twidth: 80%;\r\n\t\tmargin: auto;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.background image {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tobject-fit: cover;\r\n\t}\r\n\r\n\t.background {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tz-index: -1;\r\n\t}\r\n\r\n\t.container {\r\n\t\twidth: 558rpx;\r\n\t\tmargin: auto;\r\n\t\tbackground: rgba(252, 252, 252, 1);\r\n\t\tmin-height: 40vh;\r\n\t\tmargin-top: 130rpx;\r\n\t}\r\n\r\n\t.logo image {\r\n\t\twidth: 300rpx;\r\n\t\theight: auto;\r\n\t\tdisplay: block;\r\n\t\tmargin: auto;\r\n\t\tmargin-top: 30px;\r\n\t}\r\n\r\n\t.input {\r\n\t\tmargin: auto;\r\n\t\tmargin-top: 20px;\r\n\t}\r\n\r\n\t.login-tabs {\r\n\t\tdisplay: flex;\r\n\t\theight: 50px;\r\n\t\tline-height: 50px;\r\n\t\tborder-bottom: 1px solid rgba(214, 214, 214, 1);\r\n\t}\r\n\r\n\t.tab-btn {\r\n\t\tflex: 1;\r\n\t\ttext-align: center;\r\n\t\tfont-size: 16px;\r\n\t\tcursor: pointer;\r\n\t}\r\n\r\n\t.tab-btn.active {\r\n\t\tcolor: rgba(165, 0, 1, 1);\r\n\t\tfont-weight: bold;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t.tab-btn.active::after {\r\n\t\tcontent: '';\r\n\t\tposition: absolute;\r\n\t\tbottom: 0;\r\n\t\tleft: 20%;\r\n\t\twidth: 60%;\r\n\t\theight: 3px;\r\n\t\tbackground-color: rgba(165, 0, 1, 1);\r\n\t}\r\n\r\n\t.top-toast {\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\twidth: 100%;\r\n\t\tz-index: 9999 !important;\r\n\t}\r\n\r\n\t/* 确保uni.showToast也显示在最顶层 */\r\n\t.uni-toast--top {\r\n\t\tz-index: 9999 !important;\r\n\t}\r\n</style>","import MiniProgramPage from 'C:/Users/1764147081/Desktop/new/RecruitmentSystem-WeiXin/RecruitmentSystem-WeiXin/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["useFirstStore","ref","onMounted","uni","request","wx","MiniProgramPage"],"mappings":";;;;;;;;;;;;;;;;;;;;AAsDC,UAAM,QAAQA,aAAAA;AACd,UAAM,QAAQC,kBAAI,EAAE;AACpB,UAAM,WAAWA,kBAAI,EAAE;AACvB,UAAM,eAAeA,kBAAI,KAAK;AAC9B,UAAM,YAAYA,kBAAI,UAAU;AAChC,UAAM,cAAcA,kBAAI,EAAE;AAC1B,UAAM,cAAcA,kBAAI,KAAK;AAI7BC,kBAAAA,UAAU,MAAM;AACf,UAAI,MAAM,WAAW,OAAO;AAC3BC,sBAAAA,MAAA,MAAA,OAAA,+BAAY,aAAa;AACzBA,sBAAAA,MAAI,UAAU;AAAA,UACb,KAAK;AAAA,QACT,CAAI;AAAA,MACD;AAAA,IACH,CAAE;AAGD,aAAS,gBAAgB,MAAM;AAC9B,gBAAU,QAAQ;AAElB,kBAAY,QAAQ;AAAA,IACpB;AAGD,aAAS,mBAAmB;AAC3B,sBAAgB,SAAS;AAAA,IACzB;AAED,mBAAe,QAAQ;AAErBA,oBAAA,MAAA,MAAA,OAAA,+BAAY,UAAU,MAAM,KAAK;AACjCA,oBAAY,MAAA,MAAA,OAAA,+BAAA,aAAa,SAAS,KAAK;AAGvC,UAAI,UAAU,UAAU,WAAW;AAClC,oBAAY,QAAQ;AAAA,MACpB;AAED,UAAI;AACJ,UAAI,UAAU,UAAU,WAAW;AAClCA,sBAAAA,kDAAY,YAAY;AACxB,cAAM,cAAc;AAAA,UACnB,eAAe,MAAM;AAAA,UACrB,UAAU,SAAS;AAAA,UACnB,aAAa,MAAM;AAAA,QACxB;AAEI,YAAI,YAAY,OAAO;AACtB,sBAAY,UAAU,YAAY;AAAA,QAClC;AACD,mBAAW,MAAMC,eAAAA,QAAQ;AAAA,UACxB,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,QAAQ;AAAA,YACP,gBAAgB;AAAA,UAChB;AAAA,QACN,CAAK;AAAA,MACL,OAAU;AACND,sBAAAA,mDAAY,YAAY;AACxB,mBAAW,MAAMC,eAAAA,QAAQ;AAAA,UACxB,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAM;AAAA,YACL,eAAe,MAAM;AAAA,YACrB,UAAU,SAAS;AAAA,UACnB;AAAA,UACD,QAAQ;AAAA,YACP,gBAAgB;AAAA,UAChB;AAAA,QACN,CAAK;AAAA,MAEL;AAIG,UAAI,SAAS,SAAS,KAAK;AAC1B,cAAM,QAAQ,SAAS;AACvBD,sBAAY,MAAA,MAAA,OAAA,gCAAA,4BAA4B,KAAK;AAE7C,YAAI,aAAa,OAAO;AAEvBE,wBAAAA,KAAG,eAAe,aAAa,KAAK;AAAA,QACzC,OAAW;AAENA,wBAAAA,KAAG,eAAe,aAAa,KAAK;AAAA,QACpC;AAED,cAAM,aAAa;AAAA,UAClB;AAAA,UACA,UAAU,SAAS,KAAK;AAAA,QAC7B,CAAK;AAGDF,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAK;AAAA,QACV,CAAK;AAAA,MACL,WAAc,SAAS,SAAS,KAAK;AAEjC,YAAI,SAAS,QAAQ,SAAS;AAC7B,sBAAY,QAAQ;AACpBA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,YACN,UAAU;AAAA,UAChB,CAAM;AAAA,QACN,OAAW;AACNA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,SAAS,OAAO;AAAA,YACvB,MAAM;AAAA,YACN,UAAU;AAAA,UAChB,CAAM;AAAA,QACD;AAAA,MACL,OAAU;AAENA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO,SAAS,OAAO;AAAA,UACvB,MAAM;AAAA,UACN,UAAU;AAAA,QACf,CAAK;AAAA,MACD;AAAA,IAEF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClLF,GAAG,WAAWG,SAAe;"}